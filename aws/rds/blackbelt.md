# RDS Aurora

## DBエンジン

### Aurora
以下相当
 - MySQL
 - PostGreSQL
+αで色々機能を追加している

- Lamndaからストアドプロシージャとかトリガー実行できる
- Protection Group(10GB)毎にストレージノードを6本
  - 全部がフルデータを持ってるわけではない
- 2つのコピーに障害起きても、読み書きOK
- 3つのコミーに障害発生しても読み込みはOK
- クォーラムモデル ... レプリケーション管理のためのクォーラムモデル、コピーがいくつあれば読み込みと書き込みが可能かどうかをマッピングされている
- メンバーシップチェンジにクォーラムセットと、エポックを使う
  - 特定のノードが疑わしい状態になると、それの代わりのノードを含むクォーラムセットを作る
  - 特定のノードが死んだら、代わりのクォーラムセットに置き換える

- レプリケーションの遅延
  - binlog使ってないので10-20ms遅延
    - レプリカがMasterから更新通知だけ受け取る必要があるため
    - データは他のところで共有しているので。。。
- フェイルオーバー
  - 45から60秒
  - MARIADBドライバーを使えばもっと早い
- バックアップ
  - S3に
  - PITRで5秒Backup Retention Periodまでの任意の位置に秒単位で復元可能

- 独自のSQL
  - ALTER SYSTEM CRASH ... クラッシュされたときの挙動をシミュレート
  - ALLTER SYSTEM SIMULATE ... レプリケーションをシミュレート

- カスタムエンドポイントを作れる
  - Readerをグルーピングできるようになった
    - Reader エンドポイントはラウンドロビンでアクセスするので、きっちり役割を分ける場合には使わないこと

- グローバルDatabase
  - リージョンをまたいだレプリケーションとフェールオーバーが可能
  - Read Only
  - クロスリージョンレプリケーションなら、Writeもできる

- Aurora Serverless
  - 負荷の少ないアプリケーション
  - プロキシエンドポイントのみ作成されている
  - タイムアウト1分で設定すること

- Backtrack
  - PTTRだと時間かかってた
  - DB全体を巻き戻しなら数分で戻せる
  - 100万レコードに付き、$0.014

- Database cloning
  - データベースのコピーを作成
    - データのコピーじゃないのですぐ終わるらしい
    - なのでインスタンスの料金だけ

### オープンソース
MySQL
PostgreSQL
MariaDB

### その他
SQL Server
Oracle

## 参考
- [【AWS Black Belt Online Seminar】Amazon Aurora MySQL \- YouTube](https://www.youtube.com/watch?v=VerVNchaqVY)
