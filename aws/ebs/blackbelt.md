## EBS
EC2にアタッチするブロックレベルのストレージサービス

## 特徴
- 1GiB単位で指定し、最大16TiB
- 同一AZのみ
  - S3経由で復元は可能
- EBSはSGの全ポート閉じても使える

- SSD型
  - ランダムアクセス
  - gp2
    - 基本はこちら (Default)
    - スループットは容量に応じて変わるみたい
      - 最大5120GiBで16000IOPS
      - バースト機能で一時的に向上できる
        - クレジットが必要(IOPS単位っぽい、最大54,000,000) 
  - io1
    - 持続的なIOPSが必要な
    - DBに向いている
  - 1IOPSのカウント(I/O命令を発行した回数っぽいよ)
    - 256KiBの連続したアクセス
    - ランダムアクセスはだめ
- HDD
  - こちらもバースト機能あり
  　- st1とsc1で異なる
  - st1
    - シーケンシャルアクセスに最適
    - ビッグデータ、ETLなど
  - sc1
    - バックアップ、アーカイブ
    - 性能は低い

## Performance

- EBS Optimizedはほぼ必須とみていいよ
- EC2のスループットとIOPS, EBSのスループットIOPSとの関係を把握
- ログから現状を確認してチューニングすること

## Monitoring
- CloudWatchとOSの監視(iostat)をする
- CloudWatchはio1は1分、それ以外は5分のメトリクス送信

## NVMe SSD
- Nitroハイパーバイザーで使うので、移行する場合はOSが対応しているかを確認
- タイムアウトは最大値を設定(4294967295)
- NVMeデバイス名を使っている (/fev/nvme[0-26]n1)
  - 起動毎に変わるので、UUIDかLABELで/etc/fstabを指定すること
- Windowsはディスク番号は変更されるがドライブレターは変更されない

## Elastic Volume
EBSボリュームをEC2インスタンスにアタッチ中もサイズやIOPSを変更できる
- 拡張は○、縮小はできない

## Snapshot
バックアップを取得する
- 静止点を設けることを推奨(LInuxのxfs_freeze)
  - 作成支持レスポンスが帰るまででよい 
- 難しいならアプリ停止、ファイルシステムのアンマウントが必要
- 世代は無限

- 他リージョンにSnapshotをコピーできる(DR構成も可能になる)

### 作成方法
- CLI SDK コンソール 
- CloudWatchEvent
- Amazon DML
- AWS Backup

### 暗号化
- AES256で暗号化
- DataキーはKMSでもCMKでもOK

- 作成後の暗号化の有効化はSnapshot経由で
- 解除も別のEBS作ってrsyncなどで移動する

## Etc..
- 複数のEC2を一つのEBSにアタッチできるようになった
 - 制限あった気がする